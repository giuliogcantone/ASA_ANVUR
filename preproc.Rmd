---
title: "ANVUR NETWORK"
author: 'Giulio G: Cantone'
date: "2023-05-20"
output:
---

```{r setup, include=FALSE}
pacman::p_load(
  tidyverse,
  openalexR,
  readxl,
  nplyr,
  arrow
)
```

Sampler


```{r}
journals <- read_excel("Area13.xlsx") %>%
  filter_at(vars(-TITOLO), any_vars(. %>% str_detect("A"))) %>%
  transmute(
    journal = TITOLO,
    ISSN = ISSN %>% str_replace("‐","-")
  )
```


```{r}
oa_fetch(
  entity = "venues",
  issn = journals %>% pull(ISSN),
) -> db_j

db_j %>%
  distinct(id,
           .keep_all = T) -> db_j
```

Paper retrieval

```{r}
oa_fetch(
  entity = "works",
  primary_location.source.id = db_j$id,
  publication_year = c(2019,2022),
  authorships.institutions.country_code = "IT"
) -> db_papers_ita

db_papers_ita %>%
  filter(!is.na(author)) %>%
  transmute(
    id,
    journal = so,
    title = display_name,
         author,
         publication_date,
         year = publication_year,
         references_list = referenced_works,
         cited_by_count,
         counts_by_year,
         so_id,
         concepts
         ) -> db_papers_ita


```

Unnest

```{r}
db_papers_ita %>%
  unnest(author) %>%
  mutate(author_contribution = 1/n(),
         .by = title) %>%
    filter(
      institution_country_code == "IT",
      institution_type == "education") %>%
  select(id,journal,title,publication_date,year,references_list,cited_by_count,counts_by_year,so_id,concepts,
         author = au_display_name,
         author_contribution,
         au_id,
         institution = institution_display_name,
         department = au_affiliation_raw) -> db_papers_ita
```

data cleaning filter

```{r}
db_papers_ita %>%
  mutate(D_13 =
           case_when(
             department %>%
               tolower() %>%
               str_detect("econom|statis|busines|impres|manage|finan") ~ 1,
             TRUE ~ 0
           ),
         department = department %>% tolower(),
         department =
           case_when(
             department %>% str_detect("marco fanno") ~ "Economics and Management, Padova",
             department %>% str_detect("(?=.*?econom)(?=.*?padova)") ~ "Economics and Management, Padova",
             department %>% str_detect("(?=.*?statis)(?=.*?padova)") ~ "Statistical Sciences, Padova",
             department %>% str_detect("(?=.*?econom)(?=.*?siena)") ~ "Economics and Statistics, Siena",
             department %>% str_detect("(?=.*?busines)(?=.*?siena)") ~ "Business and Law, Siena",
             department %>% str_detect("(?=.*?school of management)(?=.*?bocconi)") ~ "School of Management, Bocconi",
             department %>% str_detect("(?=.*?finance)(?=.*?bocconi)") ~ "Finance, Bocconi",
             department %>% str_detect("(?=.*?statis)(?=.*?padova)") ~ "Statistical Sciences, Padova",
             department %>% str_detect("(?=.*?econom)(?=.*?turin)") ~ "Economics and Statistics, University of Turin",
             department %>% str_detect("(?=.*?management)(?=.*?turin)") ~ "Management, University of Turin",
             department %>% str_detect("(?=.*?econom)(?=.*?florence)") ~ "Economics, Florence",
             department %>% str_detect("(?=.*?statist)(?=.*?florence)") ~ "Statistics and Computer Science, Florence",
             department %>% str_detect("(?=.*?econom)(?=.*?bologna)") ~ "Economics, Bologna",
             department %>% str_detect("(?=.*?manage)(?=.*?bologna)") ~ "Management, Bologna",
             department %>% str_detect("(?=.*?statis)(?=.*?bologna)") ~ "Statistical Sciences, Bologna",
             department %>% str_detect("(?=.*?econom)(?=.*?sapienza)") ~ "Economics, Sapienza",
             department %>% str_detect("(?=.*?manage)(?=.*?sapienza)") ~ "Management, Sapienza",
             department %>% str_detect("(?=.*?statis)(?=.*?sapienza)") ~ "Statistical Sciences, Sapienza",
             department %>% str_detect("(politecnico).*?(milano)") ~ "Politecnico di Milano",
             department %>% str_detect("udine") ~ "Economics and Statistics, Udine",
             department %>% str_detect("messina") ~ "Economics, Messina",
             department %>% str_detect("trento") ~ "Economics and Management, Trento",
             department %>% str_detect("perugia") ~ "Economics, Perugia",
             department %>% str_detect("ferrara") ~ "Economics and Management, Ferrara",
             department %>% str_detect("foggia") ~ "Economics, Foggia",
             department %>% str_detect("brescia") ~ "Economics and Management, Brescia",
             department %>% str_detect("(?=.*?management)(?=.*?vergata)") ~ "Management and Law, Tor Vergata",
             department %>% str_detect("(?=.*?econom)(?=.*?vergata)") ~ "Economics, Tor Vergata",
             department %>% str_detect("(?=.*?econom)(?=.*?palermo)") ~ "Economics, Business and Statistics, Palermo",
             department %>% str_detect("biagi|modena") ~ "Economics, Modena and Reggio Emilia",
             department %>% str_detect("catania") ~ "Economics and Business, Catania",
             TRUE ~ department
             )
         ) -> db_papers_ita_f

db_papers_ita_f %>%
  filter(D_13 == 1) %>%
  count(department) %>%
  arrange(-n) -> IN

db_papers_ita %>%
  filter(D_13 == 0) %>%
  count(department) %>%
  arrange(-n) -> OUT

```


Italians 

```{r}



db$authors_ITA$au_display_name %>% unique() %>% length()
db$authors_ITA$id %>% unique() %>% length()
db$authors_ITA$journal %>% unique() %>% length()

db$authors_ITA %>%
  summarise(
    n = n(),
    .by = c(au_display_name)
    ) %>% arrange(-n) %>%
  head(40)
```

